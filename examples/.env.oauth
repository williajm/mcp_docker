# OAuth/OIDC Authentication Configuration Example
#
# This file shows how to configure MCP Docker with OAuth/OIDC authentication
# for secure network deployments (SSE/HTTP Stream Transport).
#
# IMPORTANT: OAuth authentication is ONLY enforced for network transports.
# The stdio transport always bypasses OAuth (local trusted process model).

# ============================================================================
# OAUTH/OIDC CONFIGURATION (Required when SECURITY_OAUTH_ENABLED=true)
# ============================================================================

# Enable OAuth authentication for network transports
SECURITY_OAUTH_ENABLED=true

# OAuth provider issuer URL (must match the 'iss' claim in JWTs)
# Examples:
#   - Auth0: https://yourdomain.auth0.com/
#   - Okta: https://yourorg.okta.com/oauth2/default
#   - Azure AD: https://login.microsoftonline.com/{tenant-id}/v2.0
#   - Keycloak: https://keycloak.example.com/realms/myrealm
SECURITY_OAUTH_ISSUER=https://auth.example.com/

# JWKS endpoint URL for JWT signature verification
# This endpoint provides public keys to validate JWT signatures
# Examples:
#   - Auth0: https://yourdomain.auth0.com/.well-known/jwks.json
#   - Okta: https://yourorg.okta.com/oauth2/default/v1/keys
#   - Azure AD: https://login.microsoftonline.com/{tenant-id}/discovery/v2.0/keys
#   - Keycloak: https://keycloak.example.com/realms/myrealm/protocol/openid-connect/certs
SECURITY_OAUTH_JWKS_URL=https://auth.example.com/.well-known/jwks.json

# Expected audience value in JWT 'aud' claim
# This should be your API identifier/audience configured in your OAuth provider
# Comma-separated list if multiple audiences are valid
SECURITY_OAUTH_AUDIENCE=mcp-docker-api,api://mcp-docker

# Required OAuth scopes (comma-separated)
# Only tokens with ALL these scopes will be accepted
# Leave empty to skip scope validation
# Examples:
#   - docker.read,docker.write (custom scopes)
#   - api:read,api:write (generic API scopes)
#   - openid,profile,email (standard OIDC scopes)
SECURITY_OAUTH_REQUIRED_SCOPES=docker.read,docker.write

# Clock skew tolerance in seconds (default: 60)
# Allows for time differences between servers when validating exp/nbf claims
SECURITY_OAUTH_CLOCK_SKEW_SECONDS=60

# ============================================================================
# OPTIONAL: TOKEN INTROSPECTION (for opaque/non-JWT tokens)
# ============================================================================

# Token introspection endpoint (optional, for opaque tokens)
# If JWT validation fails, the server will fall back to introspection
# SECURITY_OAUTH_INTROSPECTION_URL=https://auth.example.com/oauth/introspect

# Client credentials for introspection (required if introspection is used)
# SECURITY_OAUTH_CLIENT_ID=mcp-docker-server
# SECURITY_OAUTH_CLIENT_SECRET=your-client-secret-here

# ============================================================================
# TLS/HTTPS CONFIGURATION (Required for production network deployments)
# ============================================================================

# Enable TLS/HTTPS (REQUIRED for production SSE deployments)
MCP_TLS_ENABLED=true

# Path to TLS certificate file
MCP_TLS_CERT_FILE=~/.mcp-docker/certs/cert.pem

# Path to TLS private key file
MCP_TLS_KEY_FILE=~/.mcp-docker/certs/key.pem

# ============================================================================
# ADDITIONAL SECURITY SETTINGS
# ============================================================================

# IP allowlist (optional - empty list allows all IPs)
# When OAuth is enabled, both OAuth validation AND IP allowlist are enforced
# SECURITY_ALLOWED_CLIENT_IPS=127.0.0.1,192.168.1.100

# Rate limiting (recommended for production)
SECURITY_RATE_LIMIT_ENABLED=true
SECURITY_RATE_LIMIT_RPM=60
SECURITY_RATE_LIMIT_CONCURRENT=3

# Audit logging (recommended for production)
SECURITY_AUDIT_LOG_ENABLED=true
SECURITY_AUDIT_LOG_FILE=~/.mcp-docker/audit.log

# ============================================================================
# USAGE NOTES
# ============================================================================

# 1. STDIO TRANSPORT (local use, no OAuth):
#    uv run mcp-docker
#    - OAuth is BYPASSED for stdio (same trust model as `docker` CLI)
#    - No bearer token needed
#    - Suitable for local Claude Desktop integration

# 2. SSE TRANSPORT (network use, OAuth enforced):
#    uv run mcp-docker --transport sse --host 0.0.0.0 --port 8000
#    - OAuth validation is REQUIRED
#    - Clients must send: Authorization: Bearer <jwt-token>
#    - Suitable for remote access, multi-user deployments

# 3. Testing OAuth locally:
#    - Use localhost OAuth provider (e.g., Keycloak in Docker)
#    - Generate test JWTs from your provider
#    - Send requests with: curl -H "Authorization: Bearer $TOKEN" https://localhost:8000/sse

# ============================================================================
# COMMON OAUTH PROVIDERS - QUICK REFERENCE
# ============================================================================

# Auth0:
# SECURITY_OAUTH_ISSUER=https://{domain}.auth0.com/
# SECURITY_OAUTH_JWKS_URL=https://{domain}.auth0.com/.well-known/jwks.json
# SECURITY_OAUTH_AUDIENCE={api-identifier}

# Okta:
# SECURITY_OAUTH_ISSUER=https://{domain}.okta.com/oauth2/default
# SECURITY_OAUTH_JWKS_URL=https://{domain}.okta.com/oauth2/default/v1/keys
# SECURITY_OAUTH_AUDIENCE=api://{api-name}

# Azure AD:
# SECURITY_OAUTH_ISSUER=https://login.microsoftonline.com/{tenant}/v2.0
# SECURITY_OAUTH_JWKS_URL=https://login.microsoftonline.com/{tenant}/discovery/v2.0/keys
# SECURITY_OAUTH_AUDIENCE={client-id}

# Keycloak:
# SECURITY_OAUTH_ISSUER=https://keycloak.example.com/realms/{realm}
# SECURITY_OAUTH_JWKS_URL=https://keycloak.example.com/realms/{realm}/protocol/openid-connect/certs
# SECURITY_OAUTH_AUDIENCE={client-id}
