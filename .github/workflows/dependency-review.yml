name: Dependency Review

on:
  pull_request:
    branches: [ main ]

permissions:
  contents: read

jobs:
  dependency-review:
    name: Review Dependencies
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write

    steps:
    - name: Checkout code
      uses: actions/checkout@08c6903cd8c0fde910a37f88322edcfb5dd907a8 # v5.0.0

    - name: Dependency Review
      uses: actions/dependency-review-action@40c09b7dc99638e5ddb0bfd91c1673effc064d8a # v4.8.1
      with:
        # Fail the build if vulnerabilities are found
        fail-on-severity: moderate
        # License policy for all dependencies (product and CI/dev tooling)
        # Product dependencies (pyproject.toml): MIT, Apache-2.0, BSD, ISC, Python-2.0
        # CI dependencies (.github/requirements/): Also includes PSF-2.0, Unlicense
        #
        # MIT-0: Public domain equivalent (used by cffi)
        # 0BSD: Zero-clause BSD (used by typing-extensions)
        # PSF-2.0: Python Software Foundation License (used by distlib in pre-commit)
        # Unlicense: Public domain dedication (used by filelock in pre-commit)
        #
        # Note: CI/dev dependencies in .github/requirements/ are NOT distributed with
        # the mcp-docker product and do not affect the product's MIT license.
        # All allowed licenses are permissive (no copyleft).
        allow-licenses: MIT, MIT-0, Apache-2.0, BSD-2-Clause, BSD-3-Clause, 0BSD, ISC, Python-2.0, PSF-2.0, Unlicense
        comment-summary-in-pr: on-failure
        # OpenSSF Scorecard configuration
        # Set to 1.0 to allow pydantic-settings (score: 1.3) which is a well-maintained
        # transitive dependency of pydantic, used only for configuration loading
        # We still fail on packages with scores below 1.0 to catch unmaintained/risky deps
        warn-on-openssf-scorecard-level: 1.0
